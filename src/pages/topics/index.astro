---
import Layout from '../../layouts/Layout.astro';
import { getPublishedPosts } from '../../lib/notion';

export const prerender = false;
Astro.response.headers.set('Cache-Control', 'public, max-age=0, s-maxage=43200, stale-while-revalidate=86400');

const posts = await getPublishedPosts();

// Aggregate tags
const allTags = posts.flatMap(post => post.tags);
const uniqueTags = [...new Set(allTags)].sort();
---

<Layout title="Topics - Digital Garden">
  <h1 class="text-[33px] font-medium tracking-[-0.01em] mb-10 text-text-main">Topics</h1>
  
  <div class="flex flex-wrap gap-x-2 gap-y-2">
    {uniqueTags.map((tag, index) => (
      <>
        <a 
          href={`/topics/${tag.toLowerCase()}`}
          class="text-text-main hover:text-text-muted transition-colors"
        >
          {tag}
        </a>
        {index < uniqueTags.length - 1 && <span class="text-text-muted">,</span>}
      </>
    ))}
  </div>

  {uniqueTags.length === 0 && (
    <p class="text-text-muted italic">No topics found yet.</p>
  )}
</Layout>
