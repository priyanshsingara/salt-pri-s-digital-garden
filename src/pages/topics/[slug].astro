---
import Layout from '../../layouts/Layout.astro';
import { getPublishedPosts } from '../../lib/notion';
import type { Post } from '../../lib/notion';

export async function getStaticPaths() {
  const posts = await getPublishedPosts();
  const allTags = new Set(posts.flatMap(post => post.tags));
  
  return [...allTags].map(tag => ({
    params: { slug: tag.toLowerCase() },
    props: { tag },
  }));
}

interface Props {
  tag: string;
}

const { tag } = Astro.props;
const posts = await getPublishedPosts();
const filteredPosts = posts.filter(post => 
  post.tags.some(t => t.toLowerCase() === tag.toLowerCase())
);
---

<Layout title={`${tag} - Digital Garden`}>
  <header class="mb-12">
    <div class="text-secondary text-sm mb-2">Topic</div>
    <h1 class="text-3xl font-bold capitalize">{tag}</h1>
  </header>

  <ul class="flex flex-col gap-8">
    {filteredPosts.map((post) => (
      <li>
        <a href={`/${post.slug}`} class="group block">
          <div class="flex flex-col sm:flex-row sm:items-baseline justify-between gap-1 mb-1">
            <h2 class="text-lg font-medium text-ink group-hover:text-secondary transition-colors m-0">
              {post.title}
            </h2>
            <span class="text-secondary text-sm shrink-0 font-mono">
              {new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'numeric' })}
            </span>
          </div>
        </a>
      </li>
    ))}
  </ul>
</Layout>
